{% extends 'base.html' %}

{% block css %}
    <link rel="stylesheet" href="static/assets/dash/AdminLTE.min.css" />
    <script src="static/assets/css/bootstrap-timepicker.css"></script>
{% endblock %}

{% block titleinfo %}

    <div class="breadcrumbs ace-save-state" id="breadcrumbs">
        <ul class="breadcrumb">
            <i class="home-icon blue" > 资产扫描 </i>
        </ul>
    </div>

{% endblock %}

{% block webinfo %}
    <div class="row">
        <div class="col-xs-12">
            <div class="col-xs-12">
                <div class="box box-warning">
                    <div class="box-header with-border">
                        <h3 class="box-title">添加任务目标</h3>
                    </div>

                    <div class="box-body">

                        <div class="row">
                            <div class="col-xs-3">
                                <label>任务名称</label>
                                <input type="text" class="form-control" name="task_name" value="" id="task_name" placeholder="必填" />
                            </div>
                            <div class="col-xs-3">
                                <label>目标地址</label>
                                <input type="text" class="form-control" name="target_ip" value="" id="target_ip" placeholder="必填" />
                            </div>

                            <div class="col-xs-2">
                                <label>扫描策略:</label>
                                <select class="form-control" id="policy">
                                    <option value="2">masscan扫描</option selected="selected">
                                    <option value="3">nmap+masscan扫描</option>
                                    <option value="7">nmap扫描(耗时)</option>
                                </select>
                            </div>


                        <div class="row">
                             <div class="col-xs-11">
                                 <hr>
                                <label>备注</label>
                                <textarea class="form-control" rows="3" id="desc" style="resize:none" placeholder="选填"></textarea>
                            </div>

                            <div class="col-xs-12">
                                <button class="btn btn-info pull-right btn-sm" id="update">任务开始</button>
                            </div>
                        </div>
                    </div>
                <!-- /.box-body -->
                </div>
            </div>



		</div><!-- #main-widget-container -->
    </div>

{% block js %}

    <script>


    jQuery(function($) {

        $('#update').click(function () {
            const task_name = $('#task_name').val();
            const target_ip = $('#target_ip').val();
            const policy = $('#policy').val();
            const data = {
                "task_name": task_name,
                "target_ip": target_ip,
                "policy": policy,
            };
            $.ajax({
                type: 'POST',
                url: '/add_task',
                dataType: 'json',
                data: data,

                success: function (data) {
                    {#const result_json = eval(data);#}
                    {#const result = result_json.result;#}
                    {#$('#db_result').val(result);#}
                    alert("任务添加成功");
                    window.location.href="/discover";
                },
                error: function (xhr, type) {
                    alert("任务添加失败");

                }
            });
        });

    });


    </script>
    <script src="static/assets/js/bootstrap-timepicker.js"></script>
{% endblock %}

{% endblock %}